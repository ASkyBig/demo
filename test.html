<!DOCTYPE html>
<html>
<head>
  <script src="//cdn.bootcss.com/redux/3.5.2/redux.min.js"></script>
</head>
<body>
	<div id="example"></div>
<script>
const initValues = {
	'first': 0,
	'second': 10,
	'third': 20
}
/** Action Creators */
function increase(name) {
  return { type: 'INCREASE', name: name };
}
function dec(name) {
  return { type: 'DECREASE', name: name };
}

function reducer(state, action) {
  const {name} = action;
  switch (action.type) {
    case 'INCREASE':
      return { ...state, [name]: state[name] + 1 };
    case 'DECREASE':
      return { ...state, [name]: state[name] - 1 };
    default:
      return state; // 无论如何都返回一个 state
  }
}

var store = Redux.createStore(reducer, initValues);

class ControlPanel extends React.Component {
 constructor(props) {
		super(props)
		this.state = this.getOwnState()
	}
	
 getOwnState() {
	 const state = store.getState()
	 let sum = 0
	 for(const key in state){
	 	if(state.hasOwnProperty(key)){
			sum += state[key]
		}
	 }
		return {
			sum: sum
		}
	}
	
  render() {
    return (
      <div>
        <Counter name="first" } />
        <Counter name="second" />
        <Counter name="third" />
        <hr />
        <span>total: {this.state.sum}</span>
      </div>
    );
  }
	}
class Counter extends React.Component {
	constructor(props) {
		super(props)
		this.state = this.getOwnState()
	}
	
	getOwnState() {
		return {
			value: store.getState()[this.props.name]
		}
	}
	
	onIncrease(){
		store.dispatch(increase(this.props.name))
	}
	
	onDecrease(){
		store.dispatch(decrease(this.props.name))
	}
	
	onChange() {
		this.setState(this.getOwnState())
	}
	
	
	componentDidMount() {
		store.subscribe(this.onChange)
	}
	
	componentWillUnmount() {
		store.unsubscribe(this.onChange)
	}
	  render() {
	  	const {name} = this.props
	    return (
	      <div>
	        <button onClick={this.onIncrease}>+</button>
	        <span> {this.state.count} </span>
	        <button onClick={this.onDecrease}>-</button>
	        <span>{name}</span>
	      </div>
	    );
	  }
}

ReactDOM.render(
   <div>
      <ControlPanel />
   </div>,
  document.getElementById('example')
);	

</script>
</body>
</html>
